<footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-social">
        <a href="{{ .Site.Params.linkedin }}" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a>
        <a href="{{ .Site.Params.github }}" target="_blank" rel="noopener" aria-label="GitHub">GitHub</a>
        <a href="{{ .Site.Params.scholar }}" target="_blank" rel="noopener" aria-label="Google Scholar">Scholar</a>
      </div>
      <div class="footer-legal">
        <a href="{{ "privacy/" | relLangURL }}">{{ if eq .Lang "es" }}Política de privacidad{{ else }}Privacy Policy{{ end }}</a>
        <a href="{{ "cookies/" | relLangURL }}">{{ if eq .Lang "es" }}Política de cookies{{ else }}Cookie Policy{{ end }}</a>
      </div>
      <p class="footer-copyright">
        &copy; {{ now.Year }} Manuel Martín Salvador
      </p>
    </div>
  </div>
</footer>

<script>
document.querySelector('.nav-toggle').addEventListener('click', function() {
  const menu = document.querySelector('.nav-menu');
  const expanded = this.getAttribute('aria-expanded') === 'true';
  this.setAttribute('aria-expanded', !expanded);
  this.classList.toggle('is-open');
  menu.classList.toggle('is-open');
});
</script>

{{ if and .IsPage (eq .Layout "about") }}
<script>
(function() {
  if (window.innerWidth > 768) return;

  const img = document.querySelector('.timeline-image');
  if (!img) return;

  const lightbox = document.createElement('div');
  lightbox.className = 'timeline-lightbox';
  lightbox.innerHTML = `
    <button class="timeline-lightbox-close" aria-label="{{ if eq .Lang "es" }}Cerrar{{ else }}Close{{ end }}">&times;</button>
    <img src="${img.src}" alt="${img.alt}">
  `;
  document.body.appendChild(lightbox);

  img.addEventListener('click', () => lightbox.classList.add('open'));
  lightbox.addEventListener('click', () => lightbox.classList.remove('open'));
})();

(function() {
  const videos = document.querySelectorAll('.work-video');
  if (!videos.length) return;

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.play().catch(() => {});
      } else {
        entry.target.pause();
      }
    });
  }, { threshold: 0.5 });

  videos.forEach(video => observer.observe(video));
})();
</script>
{{ end }}

{{ if and .IsPage (eq .File.TranslationBaseName "contact") }}
<script type="text/javascript">
  (function (C, A, L) {
    let p = function (a, ar) { a.q.push(ar); };
    let d = C.document;
    C.Cal = C.Cal || function () {
      let cal = C.Cal;
      let ar = arguments;
      if (!cal.loaded) {
        cal.ns = {};
        cal.q = cal.q || [];
        d.head.appendChild(d.createElement("script")).src = A;
        cal.loaded = true;
      }
      if (ar[0] === L) {
        const api = function () { p(api, arguments); };
        const namespace = ar[1];
        api.q = api.q || [];
        if (typeof namespace === "string") {
          cal.ns[namespace] = cal.ns[namespace] || api;
          p(cal.ns[namespace], ar);
          p(cal, ["initNamespace", namespace]);
        } else p(cal, ar);
        return;
      }
      p(cal, ar);
    };
  })(window, "https://app.cal.com/embed/embed.js", "init");

  Cal("init", "30min", { origin: "https://app.cal.com" });
  Cal.ns["30min"]("ui", { hideEventTypeDetails: false, layout: "month_view" });
</script>
{{ end }}
